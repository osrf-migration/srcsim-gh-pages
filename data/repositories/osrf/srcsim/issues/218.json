{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/srcsim.json"}, "html": {"href": "#!/osrf/srcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{c41021d9-0217-4628-999d-7f8d82f98dcb}ts=c_plus_plus"}}, "type": "repository", "name": "srcsim", "full_name": "osrf/srcsim", "uuid": "{c41021d9-0217-4628-999d-7f8d82f98dcb}"}, "links": {"attachments": {"href": "data/repositories/osrf/srcsim/issues/218/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/srcsim/issues/218.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/srcsim/issues/218/watch"}, "comments": {"href": "data/repositories/osrf/srcsim/issues/218/comments_page=1.json"}, "html": {"href": "#!/osrf/srcsim/issues/218/docker-build-error"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/srcsim/issues/218/vote"}}, "reporter": {"display_name": "dan", "uuid": "{a93bd0ec-35fc-49a5-aa8a-b0b57403c2d0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Ba93bd0ec-35fc-49a5-aa8a-b0b57403c2d0%7D"}, "html": {"href": "https://bitbucket.org/%7Ba93bd0ec-35fc-49a5-aa8a-b0b57403c2d0%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/dd56d3105d7602d83d5c35a320f6b36cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsD-6.png"}}, "nickname": "dan77062", "type": "user", "account_id": "557058:e0e36946-cb60-4776-8f47-2e9a0285ad35"}, "title": "docker build error", "component": {"name": "cloud", "links": {"self": {"href": "data/repositories/osrf/srcsim/components/395697.json"}}}, "votes": 0, "watches": 1, "content": {"raw": "About one out of every three or four builds, docker fails to build with this CMake error.  If I just rerun the build command again, with no changes to the Dockerfile or the repo, it then builds OK.  A [stackoverflow thread](https://stackoverflow.com/questions/40765066/dockerfile-text-file-busy)  gives some hints on what is going on, but not enough to figure it out.  This is particularly bad with cloudsim, because with only VPN there is no way to know if the docker image built successfully and whether or not we are ready to start the container.\r\n\r\n```\r\n#!c++\r\n\r\nCMake Error at /opt/ros/indigo/share/catkin/cmake/safe_execute_process.cmake:11 (message):\r\n  execute_process(/root/docker/ws/build/catkin_generated/env_cached.sh\r\n  \"/usr/bin/python\" \"/usr/bin/empy\" \"--raw-errors\" \"-F\"\r\n  \"/root/docker/ws/build/catkin_generated/order_packages.py\" \"-o\"\r\n  \"/root/docker/ws/build/catkin_generated/order_packages.cmake\"\r\n  \"/opt/ros/indigo/share/catkin/cmake/em/order_packages.cmake.em\") returned\r\n  error code Text file busy\r\nCall Stack (most recent call first):\r\n  /opt/ros/indigo/share/catkin/cmake/em_expand.cmake:25 (safe_execute_process)\r\n  /opt/ros/indigo/share/catkin/cmake/catkin_workspace.cmake:35 (em_expand)\r\n  CMakeLists.txt:63 (catkin_workspace)\r\n```", "markup": "markdown", "html": "<p>About one out of every three or four builds, docker fails to build with this CMake error.  If I just rerun the build command again, with no changes to the Dockerfile or the repo, it then builds OK.  A <a data-is-external-link=\"true\" href=\"https://stackoverflow.com/questions/40765066/dockerfile-text-file-busy\" rel=\"nofollow\">stackoverflow thread</a>  gives some hints on what is going on, but not enough to figure it out.  This is particularly bad with cloudsim, because with only VPN there is no way to know if the docker image built successfully and whether or not we are ready to start the container.</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"n\">CMake</span> <span class=\"n\">Error</span> <span class=\"n\">at</span> <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">ros</span><span class=\"o\">/</span><span class=\"n\">indigo</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">catkin</span><span class=\"o\">/</span><span class=\"n\">cmake</span><span class=\"o\">/</span><span class=\"n\">safe_execute_process</span><span class=\"p\">.</span><span class=\"nl\">cmake</span><span class=\"p\">:</span><span class=\"mi\">11</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">)</span><span class=\"o\">:</span>\n  <span class=\"n\">execute_process</span><span class=\"p\">(</span><span class=\"o\">/</span><span class=\"n\">root</span><span class=\"o\">/</span><span class=\"n\">docker</span><span class=\"o\">/</span><span class=\"n\">ws</span><span class=\"o\">/</span><span class=\"n\">build</span><span class=\"o\">/</span><span class=\"n\">catkin_generated</span><span class=\"o\">/</span><span class=\"n\">env_cached</span><span class=\"p\">.</span><span class=\"n\">sh</span>\n  <span class=\"s\">&quot;/usr/bin/python&quot;</span> <span class=\"s\">&quot;/usr/bin/empy&quot;</span> <span class=\"s\">&quot;--raw-errors&quot;</span> <span class=\"s\">&quot;-F&quot;</span>\n  <span class=\"s\">&quot;/root/docker/ws/build/catkin_generated/order_packages.py&quot;</span> <span class=\"s\">&quot;-o&quot;</span>\n  <span class=\"s\">&quot;/root/docker/ws/build/catkin_generated/order_packages.cmake&quot;</span>\n  <span class=\"s\">&quot;/opt/ros/indigo/share/catkin/cmake/em/order_packages.cmake.em&quot;</span><span class=\"p\">)</span> <span class=\"n\">returned</span>\n  <span class=\"n\">error</span> <span class=\"n\">code</span> <span class=\"n\">Text</span> <span class=\"n\">file</span> <span class=\"n\">busy</span>\n<span class=\"n\">Call</span> <span class=\"n\">Stack</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">first</span><span class=\"p\">)</span><span class=\"o\">:</span>\n  <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">ros</span><span class=\"o\">/</span><span class=\"n\">indigo</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">catkin</span><span class=\"o\">/</span><span class=\"n\">cmake</span><span class=\"o\">/</span><span class=\"n\">em_expand</span><span class=\"p\">.</span><span class=\"nl\">cmake</span><span class=\"p\">:</span><span class=\"mi\">25</span> <span class=\"p\">(</span><span class=\"n\">safe_execute_process</span><span class=\"p\">)</span>\n  <span class=\"o\">/</span><span class=\"n\">opt</span><span class=\"o\">/</span><span class=\"n\">ros</span><span class=\"o\">/</span><span class=\"n\">indigo</span><span class=\"o\">/</span><span class=\"n\">share</span><span class=\"o\">/</span><span class=\"n\">catkin</span><span class=\"o\">/</span><span class=\"n\">cmake</span><span class=\"o\">/</span><span class=\"n\">catkin_workspace</span><span class=\"p\">.</span><span class=\"nl\">cmake</span><span class=\"p\">:</span><span class=\"mi\">35</span> <span class=\"p\">(</span><span class=\"n\">em_expand</span><span class=\"p\">)</span>\n  <span class=\"n\">CMakeLists</span><span class=\"p\">.</span><span class=\"nl\">txt</span><span class=\"p\">:</span><span class=\"mi\">63</span> <span class=\"p\">(</span><span class=\"n\">catkin_workspace</span><span class=\"p\">)</span>\n</pre></div>", "type": "rendered"}, "assignee": {"display_name": "Shane Loretz", "uuid": "{656e3311-aad9-45a1-aaf7-b0ee0e84b287}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D"}, "html": {"href": "https://bitbucket.org/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:684383ab-ac95-4859-a350-4a6f41a94a22/c7a1ebf5-cade-4115-9f26-9d3facb776db/128"}}, "nickname": "Shane Loretz", "type": "user", "account_id": "557058:684383ab-ac95-4859-a350-4a6f41a94a22"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2017-06-05T23:40:32.928882+00:00", "milestone": null, "updated_on": "2017-06-07T03:51:24.093014+00:00", "type": "issue", "id": 218}