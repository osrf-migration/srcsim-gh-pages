{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/srcsim.json"}, "html": {"href": "#!/osrf/srcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{c41021d9-0217-4628-999d-7f8d82f98dcb}ts=c_plus_plus"}}, "type": "repository", "name": "srcsim", "full_name": "osrf/srcsim", "uuid": "{c41021d9-0217-4628-999d-7f8d82f98dcb}"}, "links": {"attachments": {"href": "data/repositories/osrf/srcsim/issues/257/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/srcsim/issues/257.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/srcsim/issues/257/watch"}, "comments": {"href": "data/repositories/osrf/srcsim/issues/257/comments_page=1.json"}, "html": {"href": "#!/osrf/srcsim/issues/257/tcp-on-production-cloud-at-10000-ms"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/srcsim/issues/257/vote"}}, "reporter": {"display_name": "Jeremy White", "uuid": "{abab48b0-35b1-4102-8373-e88a492c5294}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Babab48b0-35b1-4102-8373-e88a492c5294%7D"}, "html": {"href": "https://bitbucket.org/%7Babab48b0-35b1-4102-8373-e88a492c5294%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/2764d3b5adf560de71f57e48a30550bad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJW-3.png"}}, "nickname": "knitfoo", "type": "user", "account_id": "557058:5de786d6-615c-44ef-8e12-f079efa38357"}, "title": "TCP on production cloud at 10000 ms suffers", "component": null, "votes": 0, "watches": 1, "content": {"raw": "We are running on round 2 and are suffering badly with our TCP comms.\r\n\r\nWe successfully navigated task 1, and made it part way through task 2.\r\n\r\nDue to a bug in our comms, we had to reconnect our OCU to the FC.  (But that is normal; our code is very tolerant of connects and disconnects, and is a planned part of our operation).\r\n\r\nBut with that new TCP connection, we were unable to regain working comms.\r\n\r\nWith a great deal of experimentation, we have determined that if we 'train' the TCP window, we can regain reliable comms.\r\n\r\nThat is, our steady state is to send about 150 bytes every other second.  Periodically, we will send 70K image bursts.  The 70k bursts will come in as 2k, 2k, and so on, until they stop at about 30k.\r\n\r\nIf instead, we send a lidar image (10k), it will come through in that slow fashion, but eventually come through.  Then if you continue requesting lidar images, they will come through, without that delay.\r\n\r\nAfter doing that, the TCP window appears to be trained, and you can get all images and everything just fine.\r\n\r\nWireshark corroborates that, although I have forgotten enough of my Stevens that I can't read what the various parameters mean.", "markup": "markdown", "html": "<p>We are running on round 2 and are suffering badly with our TCP comms.</p>\n<p>We successfully navigated task 1, and made it part way through task 2.</p>\n<p>Due to a bug in our comms, we had to reconnect our OCU to the FC.  (But that is normal; our code is very tolerant of connects and disconnects, and is a planned part of our operation).</p>\n<p>But with that new TCP connection, we were unable to regain working comms.</p>\n<p>With a great deal of experimentation, we have determined that if we 'train' the TCP window, we can regain reliable comms.</p>\n<p>That is, our steady state is to send about 150 bytes every other second.  Periodically, we will send 70K image bursts.  The 70k bursts will come in as 2k, 2k, and so on, until they stop at about 30k.</p>\n<p>If instead, we send a lidar image (10k), it will come through in that slow fashion, but eventually come through.  Then if you continue requesting lidar images, they will come through, without that delay.</p>\n<p>After doing that, the TCP window appears to be trained, and you can get all images and everything just fine.</p>\n<p>Wireshark corroborates that, although I have forgotten enough of my Stevens that I can't read what the various parameters mean.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2017-06-14T04:07:20.913972+00:00", "milestone": null, "updated_on": "2017-06-14T12:07:16.348328+00:00", "type": "issue", "id": 257}