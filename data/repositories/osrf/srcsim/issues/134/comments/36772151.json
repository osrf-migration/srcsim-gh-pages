{"links": {"self": {"href": "data/repositories/osrf/srcsim/issues/134/comments/36772151.json"}, "html": {"href": "#!/osrf/srcsim/issues/134#comment-36772151"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/srcsim/issues/134.json"}}, "type": "issue", "id": 134, "repository": {"links": {"self": {"href": "data/repositories/osrf/srcsim.json"}, "html": {"href": "#!/osrf/srcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{c41021d9-0217-4628-999d-7f8d82f98dcb}ts=c_plus_plus"}}, "type": "repository", "name": "srcsim", "full_name": "osrf/srcsim", "uuid": "{c41021d9-0217-4628-999d-7f8d82f98dcb}"}, "title": "java.io.IOException: Too many open files"}, "content": {"raw": "@knitfoo thanks for the suggestion. I tried it but can still replicate the issue. I modified `/etc/security/limits.d/ros-rtprio.conf` from step 11 of the setup guide so it looks like:\n```\n@ros - rtprio 99\n@ros hard nofile 8192\n@ros soft nofile 8192\n```\nand verified that `ulimit -n` showed 8192.  I then ran my test script again and (after somewhere between 8-16 instances) got a number of new java exceptions, plus the same 'too many open files' exception.\n\n```\nMay 11, 2017 11:30:45 PM org.jboss.netty.channel.DefaultChannelPipeline\nWARNING: An exception was thrown by a user handler while handling an exception event ([id: 0x0868b217] EXCEPTION: org.jboss.netty.channel.ChannelException: Failed to create a selector.)\norg.ros.exception.RosRuntimeException: org.jboss.netty.channel.ChannelException: Failed to create a selector.\n\tat org.ros.internal.transport.ConnectionTrackingHandler.exceptionCaught(ConnectionTrackingHandler.java:81)\n\tat org.jboss.netty.channel.Channels.fireExceptionCaught(Channels.java:533)\n\tat org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink.connect(NioClientSocketPipelineSink.java:166)\n\tat org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink.eventSunk(NioClientSocketPipelineSink.java:111)\n\tat org.jboss.netty.handler.codec.oneone.OneToOneEncoder.handleDownstream(OneToOneEncoder.java:55)\n\tat org.jboss.netty.channel.Channels.connect(Channels.java:642)\n\tat org.jboss.netty.channel.AbstractChannel.connect(AbstractChannel.java:207)\n\tat org.jboss.netty.bootstrap.ClientBootstrap.connect(ClientBootstrap.java:230)\n\tat org.jboss.netty.bootstrap.ClientBootstrap.connect(ClientBootstrap.java:183)\n\tat org.ros.internal.transport.tcp.TcpClient.connect(TcpClient.java:101)\n\tat org.ros.internal.transport.tcp.TcpClientManager.connect(TcpClientManager.java:69)\n\tat org.ros.internal.node.topic.DefaultSubscriber.addPublisher(DefaultSubscriber.java:150)\n\tat org.ros.internal.node.topic.UpdatePublisherRunnable.run(UpdatePublisherRunnable.java:73)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: org.jboss.netty.channel.ChannelException: Failed to create a selector.\n\tat org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink$Boss.register(NioClientSocketPipelineSink.java:212)\n\tat org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink.connect(NioClientSocketPipelineSink.java:161)\n\t... 13 more\nCaused by: java.io.IOException: Too many open files\n\tat sun.nio.ch.IOUtil.makePipe(Native Method)\n\tat sun.nio.ch.EPollSelectorImpl.<init>(EPollSelectorImpl.java:65)\n\tat sun.nio.ch.EPollSelectorProvider.openSelector(EPollSelectorProvider.java:36)\n\tat java.nio.channels.Selector.open(Selector.java:227)\n\tat org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink$Boss.register(NioClientSocketPipelineSink.java:210)\n\t... 14 more\n\nMay 11, 2017 11:30:46 PM org.jboss.netty.channel.socket.nio.NioServerSocketPipelineSink\nWARNING: Failed to accept a connection.\njava.io.IOException: Too many open files\n\tat sun.nio.ch.ServerSocketChannelImpl.accept0(Native Method)\n\tat sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422)\n\tat sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250)\n\tat org.jboss.netty.channel.socket.nio.NioServerSocketPipelineSink$Boss.run(NioServerSocketPipelineSink.java:238)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n```", "markup": "markdown", "html": "<p>@knitfoo thanks for the suggestion. I tried it but can still replicate the issue. I modified <code>/etc/security/limits.d/ros-rtprio.conf</code> from step 11 of the setup guide so it looks like:</p>\n<div class=\"codehilite\"><pre><span></span>@ros - rtprio 99\n@ros hard nofile 8192\n@ros soft nofile 8192\n</pre></div>\n\n\n<p>and verified that <code>ulimit -n</code> showed 8192.  I then ran my test script again and (after somewhere between 8-16 instances) got a number of new java exceptions, plus the same 'too many open files' exception.</p>\n<div class=\"codehilite\"><pre><span></span>May 11, 2017 11:30:45 PM org.jboss.netty.channel.DefaultChannelPipeline\nWARNING: An exception was thrown by a user handler while handling an exception event ([id: 0x0868b217] EXCEPTION: org.jboss.netty.channel.ChannelException: Failed to create a selector.)\norg.ros.exception.RosRuntimeException: org.jboss.netty.channel.ChannelException: Failed to create a selector.\n    at org.ros.internal.transport.ConnectionTrackingHandler.exceptionCaught(ConnectionTrackingHandler.java:81)\n    at org.jboss.netty.channel.Channels.fireExceptionCaught(Channels.java:533)\n    at org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink.connect(NioClientSocketPipelineSink.java:166)\n    at org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink.eventSunk(NioClientSocketPipelineSink.java:111)\n    at org.jboss.netty.handler.codec.oneone.OneToOneEncoder.handleDownstream(OneToOneEncoder.java:55)\n    at org.jboss.netty.channel.Channels.connect(Channels.java:642)\n    at org.jboss.netty.channel.AbstractChannel.connect(AbstractChannel.java:207)\n    at org.jboss.netty.bootstrap.ClientBootstrap.connect(ClientBootstrap.java:230)\n    at org.jboss.netty.bootstrap.ClientBootstrap.connect(ClientBootstrap.java:183)\n    at org.ros.internal.transport.tcp.TcpClient.connect(TcpClient.java:101)\n    at org.ros.internal.transport.tcp.TcpClientManager.connect(TcpClientManager.java:69)\n    at org.ros.internal.node.topic.DefaultSubscriber.addPublisher(DefaultSubscriber.java:150)\n    at org.ros.internal.node.topic.UpdatePublisherRunnable.run(UpdatePublisherRunnable.java:73)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.jboss.netty.channel.ChannelException: Failed to create a selector.\n    at org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink$Boss.register(NioClientSocketPipelineSink.java:212)\n    at org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink.connect(NioClientSocketPipelineSink.java:161)\n    ... 13 more\nCaused by: java.io.IOException: Too many open files\n    at sun.nio.ch.IOUtil.makePipe(Native Method)\n    at sun.nio.ch.EPollSelectorImpl.&lt;init&gt;(EPollSelectorImpl.java:65)\n    at sun.nio.ch.EPollSelectorProvider.openSelector(EPollSelectorProvider.java:36)\n    at java.nio.channels.Selector.open(Selector.java:227)\n    at org.jboss.netty.channel.socket.nio.NioClientSocketPipelineSink$Boss.register(NioClientSocketPipelineSink.java:210)\n    ... 14 more\n\nMay 11, 2017 11:30:46 PM org.jboss.netty.channel.socket.nio.NioServerSocketPipelineSink\nWARNING: Failed to accept a connection.\njava.io.IOException: Too many open files\n    at sun.nio.ch.ServerSocketChannelImpl.accept0(Native Method)\n    at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422)\n    at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250)\n    at org.jboss.netty.channel.socket.nio.NioServerSocketPipelineSink$Boss.run(NioServerSocketPipelineSink.java:238)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n</pre></div>", "type": "rendered"}, "created_on": "2017-05-12T03:42:58.922217+00:00", "user": {"display_name": "Steven Gray", "uuid": "{7470e809-c304-4b17-b986-685f31fa15c3}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B7470e809-c304-4b17-b986-685f31fa15c3%7D"}, "html": {"href": "https://bitbucket.org/%7B7470e809-c304-4b17-b986-685f31fa15c3%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/e6bee642b76507eb51c2839771722e68d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSG-0.png"}}, "nickname": "stgray", "type": "user", "account_id": "557058:e6cc7c7b-9d1b-4abe-87d5-5f0da7c863e1"}, "updated_on": null, "type": "issue_comment", "id": 36772151}