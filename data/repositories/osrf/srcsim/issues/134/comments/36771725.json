{"links": {"self": {"href": "data/repositories/osrf/srcsim/issues/134/comments/36771725.json"}, "html": {"href": "#!/osrf/srcsim/issues/134#comment-36771725"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/srcsim/issues/134.json"}}, "type": "issue", "id": 134, "repository": {"links": {"self": {"href": "data/repositories/osrf/srcsim.json"}, "html": {"href": "#!/osrf/srcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{c41021d9-0217-4628-999d-7f8d82f98dcb}ts=c_plus_plus"}}, "type": "repository", "name": "srcsim", "full_name": "osrf/srcsim", "uuid": "{c41021d9-0217-4628-999d-7f8d82f98dcb}"}, "title": "java.io.IOException: Too many open files"}, "content": {"raw": "I did some naive forensics on this a while back, and a stock Ubuntu system has a hard file limit of 4096.  I noticed that one of the Java processes would fork in such a way that a pair of the Java processes would end up with a limit of only 2048 file handles.  Further, it's 'startup' state was about 1800, and it would fairly quickly rise above that, and presumably run out.\n\nI've added a .conf file to /etc/security/limits.d/ that contains:\n@ros        hard    nofile           8192\n@ros        soft    nofile           8192\n\nAfter that, the two Java processes end up with 4096 each.  And since making that change, I've broadly had pretty good stability on the longer runs.\n\nThat could just be coincidence (I've made other changes), but it could be useful.  It certainly shouldn't hurt anything to add that to the srcsim image.", "markup": "markdown", "html": "<p>I did some naive forensics on this a while back, and a stock Ubuntu system has a hard file limit of 4096.  I noticed that one of the Java processes would fork in such a way that a pair of the Java processes would end up with a limit of only 2048 file handles.  Further, it's 'startup' state was about 1800, and it would fairly quickly rise above that, and presumably run out.</p>\n<p>I've added a .conf file to /etc/security/limits.d/ that contains:\n@ros        hard    nofile           8192\n@ros        soft    nofile           8192</p>\n<p>After that, the two Java processes end up with 4096 each.  And since making that change, I've broadly had pretty good stability on the longer runs.</p>\n<p>That could just be coincidence (I've made other changes), but it could be useful.  It certainly shouldn't hurt anything to add that to the srcsim image.</p>", "type": "rendered"}, "created_on": "2017-05-12T02:58:20.590405+00:00", "user": {"display_name": "Jeremy White", "uuid": "{abab48b0-35b1-4102-8373-e88a492c5294}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Babab48b0-35b1-4102-8373-e88a492c5294%7D"}, "html": {"href": "https://bitbucket.org/%7Babab48b0-35b1-4102-8373-e88a492c5294%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/2764d3b5adf560de71f57e48a30550bad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJW-3.png"}}, "nickname": "knitfoo", "type": "user", "account_id": "557058:5de786d6-615c-44ef-8e12-f079efa38357"}, "updated_on": null, "type": "issue_comment", "id": 36771725}