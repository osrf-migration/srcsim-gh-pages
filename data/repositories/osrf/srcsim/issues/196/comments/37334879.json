{"links": {"self": {"href": "data/repositories/osrf/srcsim/issues/196/comments/37334879.json"}, "html": {"href": "#!/osrf/srcsim/issues/196#comment-37334879"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/srcsim/issues/196.json"}}, "type": "issue", "id": 196, "repository": {"links": {"self": {"href": "data/repositories/osrf/srcsim.json"}, "html": {"href": "#!/osrf/srcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{c41021d9-0217-4628-999d-7f8d82f98dcb}ts=c_plus_plus"}}, "type": "repository", "name": "srcsim", "full_name": "osrf/srcsim", "uuid": "{c41021d9-0217-4628-999d-7f8d82f98dcb}"}, "title": "Pelvis vs Foot Orientation after teleport"}, "content": {"raw": "It's not just the `/ihmc_ros/valkyrie/output/robot_pose` that publishes a wrong translation, the /tf is too, and the whole robot is skewed to one side.\n\nWhat we see is that after teleporting on task 3, when we send the first step, the whole robot slides to one side 20cm more or less on rviz. Rviz is not listening to `/ihmc_ros/valkyrie/output/robot_pose`, to me it looks like the /world <-> /pelvis transform that is also publishing wrong data.\n\nSee below the values printed by the world-pelvis transform and the robot_pose topic.\n```\n#!c++\n\nrosrun tf tf_echo pelvis world\nAt time 234.526\n- Translation: [0.142, -0.055, -0.988]\n- Rotation: in Quaternion [0.000, 0.000, 1.000, 0.031]\n            in RPY (radian) [0.000, -0.001, 3.080]\n            in RPY (degree) [0.002, -0.052, 176.488]\nAt time 234.526\n- Translation: [0.142, -0.055, -0.988]\n- Rotation: in Quaternion [0.000, 0.000, 1.000, 0.031]\n            in RPY (radian) [0.000, -0.001, 3.080]\n            in RPY (degree) [0.002, -0.052, 176.488]\n\n\nrostopic echo /ihmc_ros/valkyrie/output/robot_pose -n1\nheader: \n  seq: 116226\n  stamp: \n    secs: 236\n    nsecs: 227000000\n  frame_id: world\nchild_frame_id: pelvis\npose: \n  pose: \n    position: \n      x: 0.145725026727\n      y: -0.0465376377106\n      z: 0.987797141075\n    orientation: \n      x: 0.000446841295343\n      y: 7.99729878054e-06\n      z: 0.999530434608\n      w: -0.0306381732225\n  covariance: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]\ntwist: \n  twist: \n    linear: \n      x: 0.00011956605158\n      y: 0.000118909287266\n      z: -0.000486532022478\n    angular: \n      x: 0.000191804327187\n      y: 0.000383036735002\n      z: -0.000364075094694\n  covariance: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]\n```", "markup": "markdown", "html": "<p>It's not just the <code>/ihmc_ros/valkyrie/output/robot_pose</code> that publishes a wrong translation, the /tf is too, and the whole robot is skewed to one side.</p>\n<p>What we see is that after teleporting on task 3, when we send the first step, the whole robot slides to one side 20cm more or less on rviz. Rviz is not listening to <code>/ihmc_ros/valkyrie/output/robot_pose</code>, to me it looks like the /world &lt;-&gt; /pelvis transform that is also publishing wrong data.</p>\n<p>See below the values printed by the world-pelvis transform and the robot_pose topic.</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"n\">rosrun</span> <span class=\"n\">tf</span> <span class=\"n\">tf_echo</span> <span class=\"n\">pelvis</span> <span class=\"n\">world</span>\n<span class=\"n\">At</span> <span class=\"n\">time</span> <span class=\"mf\">234.526</span>\n<span class=\"o\">-</span> <span class=\"nl\">Translation</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"mf\">0.142</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.055</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.988</span><span class=\"p\">]</span>\n<span class=\"o\">-</span> <span class=\"nl\">Rotation</span><span class=\"p\">:</span> <span class=\"n\">in</span> <span class=\"n\">Quaternion</span> <span class=\"p\">[</span><span class=\"mf\">0.000</span><span class=\"p\">,</span> <span class=\"mf\">0.000</span><span class=\"p\">,</span> <span class=\"mf\">1.000</span><span class=\"p\">,</span> <span class=\"mf\">0.031</span><span class=\"p\">]</span>\n            <span class=\"n\">in</span> <span class=\"n\">RPY</span> <span class=\"p\">(</span><span class=\"n\">radian</span><span class=\"p\">)</span> <span class=\"p\">[</span><span class=\"mf\">0.000</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.001</span><span class=\"p\">,</span> <span class=\"mf\">3.080</span><span class=\"p\">]</span>\n            <span class=\"n\">in</span> <span class=\"n\">RPY</span> <span class=\"p\">(</span><span class=\"n\">degree</span><span class=\"p\">)</span> <span class=\"p\">[</span><span class=\"mf\">0.002</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.052</span><span class=\"p\">,</span> <span class=\"mf\">176.488</span><span class=\"p\">]</span>\n<span class=\"n\">At</span> <span class=\"n\">time</span> <span class=\"mf\">234.526</span>\n<span class=\"o\">-</span> <span class=\"nl\">Translation</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"mf\">0.142</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.055</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.988</span><span class=\"p\">]</span>\n<span class=\"o\">-</span> <span class=\"nl\">Rotation</span><span class=\"p\">:</span> <span class=\"n\">in</span> <span class=\"n\">Quaternion</span> <span class=\"p\">[</span><span class=\"mf\">0.000</span><span class=\"p\">,</span> <span class=\"mf\">0.000</span><span class=\"p\">,</span> <span class=\"mf\">1.000</span><span class=\"p\">,</span> <span class=\"mf\">0.031</span><span class=\"p\">]</span>\n            <span class=\"n\">in</span> <span class=\"n\">RPY</span> <span class=\"p\">(</span><span class=\"n\">radian</span><span class=\"p\">)</span> <span class=\"p\">[</span><span class=\"mf\">0.000</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.001</span><span class=\"p\">,</span> <span class=\"mf\">3.080</span><span class=\"p\">]</span>\n            <span class=\"n\">in</span> <span class=\"n\">RPY</span> <span class=\"p\">(</span><span class=\"n\">degree</span><span class=\"p\">)</span> <span class=\"p\">[</span><span class=\"mf\">0.002</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">0.052</span><span class=\"p\">,</span> <span class=\"mf\">176.488</span><span class=\"p\">]</span>\n\n\n<span class=\"n\">rostopic</span> <span class=\"n\">echo</span> <span class=\"o\">/</span><span class=\"n\">ihmc_ros</span><span class=\"o\">/</span><span class=\"n\">valkyrie</span><span class=\"o\">/</span><span class=\"n\">output</span><span class=\"o\">/</span><span class=\"n\">robot_pose</span> <span class=\"o\">-</span><span class=\"n\">n1</span>\n<span class=\"nl\">header</span><span class=\"p\">:</span> \n  <span class=\"nl\">seq</span><span class=\"p\">:</span> <span class=\"mi\">116226</span>\n  <span class=\"nl\">stamp</span><span class=\"p\">:</span> \n    <span class=\"nl\">secs</span><span class=\"p\">:</span> <span class=\"mi\">236</span>\n    <span class=\"nl\">nsecs</span><span class=\"p\">:</span> <span class=\"mi\">227000000</span>\n  <span class=\"nl\">frame_id</span><span class=\"p\">:</span> <span class=\"n\">world</span>\n<span class=\"nl\">child_frame_id</span><span class=\"p\">:</span> <span class=\"n\">pelvis</span>\n<span class=\"nl\">pose</span><span class=\"p\">:</span> \n  <span class=\"nl\">pose</span><span class=\"p\">:</span> \n    <span class=\"nl\">position</span><span class=\"p\">:</span> \n      <span class=\"nl\">x</span><span class=\"p\">:</span> <span class=\"mf\">0.145725026727</span>\n      <span class=\"nl\">y</span><span class=\"p\">:</span> <span class=\"o\">-</span><span class=\"mf\">0.0465376377106</span>\n      <span class=\"nl\">z</span><span class=\"p\">:</span> <span class=\"mf\">0.987797141075</span>\n    <span class=\"nl\">orientation</span><span class=\"p\">:</span> \n      <span class=\"nl\">x</span><span class=\"p\">:</span> <span class=\"mf\">0.000446841295343</span>\n      <span class=\"nl\">y</span><span class=\"p\">:</span> <span class=\"mf\">7.99729878054e-06</span>\n      <span class=\"nl\">z</span><span class=\"p\">:</span> <span class=\"mf\">0.999530434608</span>\n      <span class=\"nl\">w</span><span class=\"p\">:</span> <span class=\"o\">-</span><span class=\"mf\">0.0306381732225</span>\n  <span class=\"nl\">covariance</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">]</span>\n<span class=\"nl\">twist</span><span class=\"p\">:</span> \n  <span class=\"nl\">twist</span><span class=\"p\">:</span> \n    <span class=\"nl\">linear</span><span class=\"p\">:</span> \n      <span class=\"nl\">x</span><span class=\"p\">:</span> <span class=\"mf\">0.00011956605158</span>\n      <span class=\"nl\">y</span><span class=\"p\">:</span> <span class=\"mf\">0.000118909287266</span>\n      <span class=\"nl\">z</span><span class=\"p\">:</span> <span class=\"o\">-</span><span class=\"mf\">0.000486532022478</span>\n    <span class=\"nl\">angular</span><span class=\"p\">:</span> \n      <span class=\"nl\">x</span><span class=\"p\">:</span> <span class=\"mf\">0.000191804327187</span>\n      <span class=\"nl\">y</span><span class=\"p\">:</span> <span class=\"mf\">0.000383036735002</span>\n      <span class=\"nl\">z</span><span class=\"p\">:</span> <span class=\"o\">-</span><span class=\"mf\">0.000364075094694</span>\n  <span class=\"nl\">covariance</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">,</span> <span class=\"mf\">0.0</span><span class=\"p\">]</span>\n</pre></div>", "type": "rendered"}, "created_on": "2017-06-02T10:49:01.720913+00:00", "user": {"display_name": "V\u00edctor L\u00f3pez", "uuid": "{45ae86e9-e602-472d-b978-9915cf7f0b94}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B45ae86e9-e602-472d-b978-9915cf7f0b94%7D"}, "html": {"href": "https://bitbucket.org/%7B45ae86e9-e602-472d-b978-9915cf7f0b94%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/441581ed0d88303764d0971c84961d4dd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsVL-3.png"}}, "nickname": "Victor Lopez", "type": "user", "account_id": "557058:be4eaa58-1e6c-457d-b177-531b37dc6861"}, "updated_on": "2017-06-02T10:57:13.299761+00:00", "type": "issue_comment", "id": 37334879}