{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/srcsim.json"}, "html": {"href": "#!/osrf/srcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{c41021d9-0217-4628-999d-7f8d82f98dcb}ts=c_plus_plus"}}, "type": "repository", "name": "srcsim", "full_name": "osrf/srcsim", "uuid": "{c41021d9-0217-4628-999d-7f8d82f98dcb}"}, "links": {"attachments": {"href": "data/repositories/osrf/srcsim/issues/230/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/srcsim/issues/230.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/srcsim/issues/230/watch"}, "comments": {"href": "data/repositories/osrf/srcsim/issues/230/comments_page=1.json"}, "html": {"href": "#!/osrf/srcsim/issues/230/traffic-shaping-seems-to-break-ros"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/srcsim/issues/230/vote"}}, "reporter": {"display_name": "Jeremy White", "uuid": "{abab48b0-35b1-4102-8373-e88a492c5294}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Babab48b0-35b1-4102-8373-e88a492c5294%7D"}, "html": {"href": "https://bitbucket.org/%7Babab48b0-35b1-4102-8373-e88a492c5294%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/2764d3b5adf560de71f57e48a30550bad=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJW-3.png"}}, "nickname": "knitfoo", "type": "user", "account_id": "557058:5de786d6-615c-44ef-8e12-f079efa38357"}, "title": "Traffic shaping seems to break ros connection between FC and SIM", "component": null, "votes": 0, "watches": 1, "content": {"raw": "In experimenting with the traffic shaping on a current container, I have found that if I apply shaping, and then start the fc, things work as I expect.  If, however, I change the shaping parameters (even to make them 'nicer') while the fc is running, the fc loses it's ros connection to the sim, and cannot re-establish it until it is restarted.\r\n\r\nI gather that is the planned production behavior (change shaping after each task completes), so I wanted to make sure to point it out now.\r\n\r\nThe relevant stack trace is:\r\n```\r\n#!python\r\n\r\n  File \"./lib/zarj/walk.py\", line 88, in __init__\r\n    if rospy.has_param(rfp) and rospy.has_param(lfp):\r\n  File \"/opt/ros/indigo/lib/python2.7/dist-packages/rospy/client.py\", line 546, in has_param\r\n    return param_name in _param_server #MasterProxy does all the magic for us\r\n  File \"/opt/ros/indigo/lib/python2.7/dist-packages/rospy/msproxy.py\", line 195, in __contains__\r\n    code, msg, value = self.target.hasParam(rospy.names.get_caller_id(), rospy.names.resolve_name(key))\r\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1233, in __call__\r\n    return self.__send(self.__name, args)\r\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1587, in __request\r\n    verbose=self.__verbose\r\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1273, in request\r\n    return self.single_request(host, handler, request_body, verbose)\r\n  File \"/usr/lib/python2.7/xmlrpclib.py\", line 1303, in single_request\r\n    response = h.getresponse(buffering=True)\r\n  File \"/usr/lib/python2.7/httplib.py\", line 1089, in getresponse\r\n    response.begin()\r\n  File \"/usr/lib/python2.7/httplib.py\", line 444, in begin\r\n    version, status, reason = self._read_status()\r\n  File \"/usr/lib/python2.7/httplib.py\", line 400, in _read_status\r\n    line = self.fp.readline(_MAXLINE + 1)\r\n  File \"/usr/lib/python2.7/socket.py\", line 476, in readline\r\n    data = self._sock.recv(self._rbufsize)\r\n\r\n```", "markup": "markdown", "html": "<p>In experimenting with the traffic shaping on a current container, I have found that if I apply shaping, and then start the fc, things work as I expect.  If, however, I change the shaping parameters (even to make them 'nicer') while the fc is running, the fc loses it's ros connection to the sim, and cannot re-establish it until it is restarted.</p>\n<p>I gather that is the planned production behavior (change shaping after each task completes), so I wanted to make sure to point it out now.</p>\n<p>The relevant stack trace is:</p>\n<div class=\"codehilite language-python\"><pre><span></span>  <span class=\"n\">File</span> <span class=\"s2\">&quot;./lib/zarj/walk.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">88</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__init__</span>\n    <span class=\"k\">if</span> <span class=\"n\">rospy</span><span class=\"o\">.</span><span class=\"n\">has_param</span><span class=\"p\">(</span><span class=\"n\">rfp</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">rospy</span><span class=\"o\">.</span><span class=\"n\">has_param</span><span class=\"p\">(</span><span class=\"n\">lfp</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/opt/ros/indigo/lib/python2.7/dist-packages/rospy/client.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">546</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">has_param</span>\n    <span class=\"k\">return</span> <span class=\"n\">param_name</span> <span class=\"ow\">in</span> <span class=\"n\">_param_server</span> <span class=\"c1\">#MasterProxy does all the magic for us</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/opt/ros/indigo/lib/python2.7/dist-packages/rospy/msproxy.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">195</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__contains__</span>\n    <span class=\"n\">code</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">target</span><span class=\"o\">.</span><span class=\"n\">hasParam</span><span class=\"p\">(</span><span class=\"n\">rospy</span><span class=\"o\">.</span><span class=\"n\">names</span><span class=\"o\">.</span><span class=\"n\">get_caller_id</span><span class=\"p\">(),</span> <span class=\"n\">rospy</span><span class=\"o\">.</span><span class=\"n\">names</span><span class=\"o\">.</span><span class=\"n\">resolve_name</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">))</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/usr/lib/python2.7/xmlrpclib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1233</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"fm\">__call__</span>\n    <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__send</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/usr/lib/python2.7/xmlrpclib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1587</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">__request</span>\n    <span class=\"n\">verbose</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">__verbose</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/usr/lib/python2.7/xmlrpclib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1273</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">request</span>\n    <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">single_request</span><span class=\"p\">(</span><span class=\"n\">host</span><span class=\"p\">,</span> <span class=\"n\">handler</span><span class=\"p\">,</span> <span class=\"n\">request_body</span><span class=\"p\">,</span> <span class=\"n\">verbose</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/usr/lib/python2.7/xmlrpclib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1303</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">single_request</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">h</span><span class=\"o\">.</span><span class=\"n\">getresponse</span><span class=\"p\">(</span><span class=\"n\">buffering</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/usr/lib/python2.7/httplib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1089</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">getresponse</span>\n    <span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\">begin</span><span class=\"p\">()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/usr/lib/python2.7/httplib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">444</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">begin</span>\n    <span class=\"n\">version</span><span class=\"p\">,</span> <span class=\"n\">status</span><span class=\"p\">,</span> <span class=\"n\">reason</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_read_status</span><span class=\"p\">()</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/usr/lib/python2.7/httplib.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">400</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">_read_status</span>\n    <span class=\"n\">line</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fp</span><span class=\"o\">.</span><span class=\"n\">readline</span><span class=\"p\">(</span><span class=\"n\">_MAXLINE</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;/usr/lib/python2.7/socket.py&quot;</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">476</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"n\">readline</span>\n    <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_sock</span><span class=\"o\">.</span><span class=\"n\">recv</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_rbufsize</span><span class=\"p\">)</span>\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "closed", "version": null, "edited_on": null, "created_on": "2017-06-07T19:38:33.883148+00:00", "milestone": null, "updated_on": "2017-06-07T22:42:59.022291+00:00", "type": "issue", "id": 230}