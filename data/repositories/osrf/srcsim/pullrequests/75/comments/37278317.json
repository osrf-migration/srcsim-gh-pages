{"links": {"self": {"href": "data/repositories/osrf/srcsim/pullrequests/75/comments/37278317.json"}, "html": {"href": "#!/osrf/srcsim/pull-requests/75/_/diff#comment-37278317"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 75, "links": {"self": {"href": "data/repositories/osrf/srcsim/pullrequests/75.json"}, "html": {"href": "#!/osrf/srcsim/pull-requests/75"}}, "title": "Increase simulation step size to 2ms"}, "content": {"raw": "Ideally, we would have read the controller delay parameters from the plugin xml in the urdf file, but unfortunately we didn't do that. I've observed the oscillations that occur when commanding a pelvis pitch. I've tried adjusting the controller wait parameters. If I increase the time it is allowed to wait for controller synchronization, then stability improves, but it slows down the simulation. The initial values were chosen to err on the side of caution, but we'll have to make a trade-off between speed and stability.\n\nI've uploaded some scripts to modify these controller delays in the `libval_gazebo.so` binary in case people want to experiment with different values of these parameters:\n\n* https://bitbucket.org/scpeters/unix-stuff/src/6729814ab/libval_gazebo_hacking/\n\nThe [osrf1 deb](https://osrf-distributions.s3.amazonaws.com/srcsim/val-gazebo_4.1.0.0-2016.12.07.23.54.28-14f009a4%2Bosrf1_amd64.deb) that I uploaded 2 days ago had values of `100 us` for the sensor wait and `200 us` for the controller wait, and I get a real time factor of 0.50 on my desktop machine in the qual2 world. I just tried increasing the control delay to `400 us` and that improved the stability a little.\n\nNote that controller synchronization turns on 30 seconds after the model is loaded, which should be the case before 40 seconds of sim time have passed. The effect of controller delays won't be noticeable until after that time.", "markup": "markdown", "html": "<p>Ideally, we would have read the controller delay parameters from the plugin xml in the urdf file, but unfortunately we didn't do that. I've observed the oscillations that occur when commanding a pelvis pitch. I've tried adjusting the controller wait parameters. If I increase the time it is allowed to wait for controller synchronization, then stability improves, but it slows down the simulation. The initial values were chosen to err on the side of caution, but we'll have to make a trade-off between speed and stability.</p>\n<p>I've uploaded some scripts to modify these controller delays in the <code>libval_gazebo.so</code> binary in case people want to experiment with different values of these parameters:</p>\n<ul>\n<li><a href=\"https://bitbucket.org/scpeters/unix-stuff/src/6729814ab/libval_gazebo_hacking/\" rel=\"nofollow\" class=\"ap-connect-link\">https://bitbucket.org/scpeters/unix-stuff/src/6729814ab/libval_gazebo_hacking/</a></li>\n</ul>\n<p>The <a data-is-external-link=\"true\" href=\"https://osrf-distributions.s3.amazonaws.com/srcsim/val-gazebo_4.1.0.0-2016.12.07.23.54.28-14f009a4%2Bosrf1_amd64.deb\" rel=\"nofollow\">osrf1 deb</a> that I uploaded 2 days ago had values of <code>100 us</code> for the sensor wait and <code>200 us</code> for the controller wait, and I get a real time factor of 0.50 on my desktop machine in the qual2 world. I just tried increasing the control delay to <code>400 us</code> and that improved the stability a little.</p>\n<p>Note that controller synchronization turns on 30 seconds after the model is loaded, which should be the case before 40 seconds of sim time have passed. The effect of controller delays won't be noticeable until after that time.</p>", "type": "rendered"}, "created_on": "2017-05-19T23:02:37.177508+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-05-19T23:02:37.179628+00:00", "type": "pullrequest_comment", "id": 37278317}